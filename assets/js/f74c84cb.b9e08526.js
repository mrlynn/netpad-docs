"use strict";(self.webpackChunkdocs_netpad_io=self.webpackChunkdocs_netpad_io||[]).push([[1918],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var s=t(96540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},83106:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"extensions/building-extensions","title":"Building Extensions","description":"Step-by-step guide to creating NetPad extensions","source":"@site/docs/extensions/building-extensions.md","sourceDirName":"extensions","slug":"/extensions/building-extensions","permalink":"/docs/extensions/building-extensions","draft":false,"unlisted":false,"editUrl":"https://github.com/mrlynn/netpad-v3/tree/main/docs/docs/extensions/building-extensions.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Building Extensions","description":"Step-by-step guide to creating NetPad extensions"},"sidebar":"docs","previous":{"title":"\ud83c\udfd7\ufe0f Architecture","permalink":"/docs/extensions/architecture"},"next":{"title":"\ud83e\udde9 Workflow Nodes","permalink":"/docs/extensions/workflow-nodes"}}');var i=t(74848),r=t(28453);const o={sidebar_position:3,title:"Building Extensions",description:"Step-by-step guide to creating NetPad extensions"},d="Building NetPad Extensions",a={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Project Structure",id:"project-structure",level:2},{value:"Step 1: Initialize the Package",id:"step-1-initialize-the-package",level:2},{value:"Step 2: Configure TypeScript",id:"step-2-configure-typescript",level:2},{value:"Step 3: Configure Build",id:"step-3-configure-build",level:2},{value:"Step 4: Define Types",id:"step-4-define-types",level:2},{value:"Step 5: Implement Services",id:"step-5-implement-services",level:2},{value:"Step 6: Create the Extension",id:"step-6-create-the-extension",level:2},{value:"Step 7: Create React Components",id:"step-7-create-react-components",level:2},{value:"Step 8: Build the Extension",id:"step-8-build-the-extension",level:2},{value:"Step 9: Integrate with NetPad",id:"step-9-integrate-with-netpad",level:2},{value:"Link the Package",id:"link-the-package",level:3},{value:"Register the Extension Loader",id:"register-the-extension-loader",level:3},{value:"Enable the Extension",id:"enable-the-extension",level:3},{value:"Step 10: Test the Extension",id:"step-10-test-the-extension",level:2},{value:"Step 11: Use Components",id:"step-11-use-components",level:2},{value:"Writing Tests",id:"writing-tests",level:2},{value:"Publishing Your Extension",id:"publishing-your-extension",level:2},{value:"Adding Workflow Nodes",id:"adding-workflow-nodes",level:2},{value:"Step 1: Create the Node Handler",id:"step-1-create-the-node-handler",level:3},{value:"Step 2: Export the Node",id:"step-2-export-the-node",level:3},{value:"Step 3: Register in the Extension",id:"step-3-register-in-the-extension",level:3},{value:"Step 4: Update Build Configuration",id:"step-4-update-build-configuration",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Architecture Diagram",id:"architecture-diagram",level:3},{value:"Node Definition Fields",id:"node-definition-fields",level:3},{value:"Available Icons",id:"available-icons",level:3},{value:"Config Field Types",id:"config-field-types",level:3},{value:"Select Field Options",id:"select-field-options",level:4},{value:"Variable Support in Config Fields",id:"variable-support-in-config-fields",level:3},{value:"Error Codes",id:"error-codes",level:3},{value:"Testing Your Workflow Node",id:"testing-your-workflow-node",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"General Extension Development",id:"general-extension-development",level:3},{value:"Workflow Node Best Practices",id:"workflow-node-best-practices",level:3},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"building-netpad-extensions",children:"Building NetPad Extensions"})}),"\n",(0,i.jsx)(n.p,{children:"This tutorial walks you through creating a NetPad extension from scratch. By the end, you'll have a fully functional extension with API routes, services, and React components."}),"\n",(0,i.jsxs)(n.admonition,{title:"Quick Start with MCP Server",type:"tip",children:[(0,i.jsxs)(n.p,{children:["If you're using an AI assistant with the ",(0,i.jsx)(n.a,{href:"/docs/developer/mcp-server",children:"NetPad MCP Server"}),", you can generate complete extension packages automatically:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'"Create a NetPad extension with a custom workflow node that logs messages"\n'})}),(0,i.jsxs)(n.p,{children:["The MCP Server's ",(0,i.jsx)(n.code,{children:"generate_extension"})," tool creates all necessary files (package.json, tsconfig, source code, README) ready to build and install. This is the fastest way to get started!"]})]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Node.js 18+ and npm"}),"\n",(0,i.jsx)(n.li,{children:"Basic knowledge of TypeScript and React"}),"\n",(0,i.jsx)(n.li,{children:"Understanding of Next.js API routes"}),"\n",(0,i.jsx)(n.li,{children:"A NetPad development environment"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,i.jsx)(n.p,{children:"A typical extension package has this structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"packages/my-extension/\n\u251c\u2500\u2500 package.json           # Package configuration\n\u251c\u2500\u2500 tsconfig.json          # TypeScript configuration\n\u251c\u2500\u2500 tsup.config.ts         # Build configuration\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 index.ts           # Main extension entry point\n\u2502   \u251c\u2500\u2500 types/\n\u2502   \u2502   \u2514\u2500\u2500 index.ts       # Type definitions\n\u2502   \u251c\u2500\u2500 components/\n\u2502   \u2502   \u251c\u2500\u2500 index.ts       # Component exports\n\u2502   \u2502   \u2514\u2500\u2500 MyComponent.tsx\n\u2502   \u2514\u2500\u2500 services/\n\u2502       \u2514\u2500\u2500 myService.ts   # Business logic\n\u251c\u2500\u2500 dist/                  # Built output (generated)\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-1-initialize-the-package",children:"Step 1: Initialize the Package"}),"\n",(0,i.jsx)(n.p,{children:"Create the package directory and initialize:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p packages/my-extension\ncd packages/my-extension\nnpm init -y\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@myorg/my-extension",\n  "version": "1.0.0",\n  "description": "My custom NetPad extension",\n  "main": "dist/index.js",\n  "module": "dist/index.mjs",\n  "types": "dist/index.d.ts",\n  "exports": {\n    ".": {\n      "types": "./dist/index.d.ts",\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.js"\n    },\n    "./components": {\n      "types": "./dist/components/index.d.ts",\n      "import": "./dist/components/index.mjs",\n      "require": "./dist/components/index.js"\n    }\n  },\n  "scripts": {\n    "build": "tsup",\n    "dev": "tsup --watch",\n    "clean": "rm -rf dist",\n    "typecheck": "tsc --noEmit"\n  },\n  "peerDependencies": {\n    "@mui/icons-material": ">=5.0.0",\n    "@mui/material": ">=5.0.0",\n    "next": ">=14.0.0",\n    "react": ">=18.0.0"\n  },\n  "devDependencies": {\n    "@types/node": "^20.0.0",\n    "@types/react": "^18.0.0",\n    "tsup": "^8.0.0",\n    "typescript": "^5.0.0"\n  },\n  "files": [\n    "dist",\n    "README.md"\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-2-configure-typescript",children:"Step 2: Configure TypeScript"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"tsconfig.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "compilerOptions": {\n    "target": "ES2020",\n    "module": "ESNext",\n    "moduleResolution": "bundler",\n    "lib": ["ES2020", "DOM", "DOM.Iterable"],\n    "jsx": "react-jsx",\n    "strict": true,\n    "esModuleInterop": true,\n    "skipLibCheck": true,\n    "forceConsistentCasingInFileNames": true,\n    "declaration": true,\n    "declarationMap": true,\n    "outDir": "./dist",\n    "rootDir": "./src",\n    "resolveJsonModule": true,\n    "isolatedModules": true,\n    "noEmit": true\n  },\n  "include": ["src/**/*"],\n  "exclude": ["node_modules", "dist"]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-3-configure-build",children:"Step 3: Configure Build"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"tsup.config.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { defineConfig } from 'tsup';\n\nexport default defineConfig({\n  entry: {\n    index: 'src/index.ts',\n    'components/index': 'src/components/index.ts',\n  },\n  format: ['cjs', 'esm'],\n  dts: true,\n  clean: true,\n  external: [\n    'react',\n    'react-dom',\n    'next',\n    'next/server',\n    '@mui/material',\n    '@mui/icons-material',\n  ],\n  treeshake: true,\n  splitting: false,\n  sourcemap: true,\n  esbuildOptions(options) {\n    options.banner = {\n      js: '\"use client\";',\n    };\n  },\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-4-define-types",children:"Step 4: Define Types"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/types/index.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"/**\n * Types for my extension\n */\n\nexport interface MyData {\n  id: string;\n  name: string;\n  description?: string;\n  createdAt: Date;\n}\n\nexport interface MyServiceConfig {\n  apiKey?: string;\n  enabled: boolean;\n}\n\nexport interface MyService {\n  getData(): Promise<MyData[]>;\n  createData(data: Omit<MyData, 'id' | 'createdAt'>): Promise<MyData>;\n  deleteData(id: string): Promise<void>;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-5-implement-services",children:"Step 5: Implement Services"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/services/myService.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { MyData, MyService, MyServiceConfig } from '../types';\n\nlet config: MyServiceConfig = {\n  enabled: false,\n};\n\n// In-memory storage for demo (use MongoDB in production)\nconst dataStore: Map<string, MyData> = new Map();\n\nexport function configure(newConfig: Partial<MyServiceConfig>): void {\n  config = { ...config, ...newConfig };\n}\n\nexport const myService: MyService = {\n  async getData(): Promise<MyData[]> {\n    return Array.from(dataStore.values());\n  },\n\n  async createData(data: Omit<MyData, 'id' | 'createdAt'>): Promise<MyData> {\n    const newData: MyData = {\n      ...data,\n      id: `data_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n      createdAt: new Date(),\n    };\n    dataStore.set(newData.id, newData);\n    return newData;\n  },\n\n  async deleteData(id: string): Promise<void> {\n    dataStore.delete(id);\n  },\n};\n\nexport default myService;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-6-create-the-extension",children:"Step 6: Create the Extension"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/index.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"/**\n * My NetPad Extension\n *\n * Provides custom functionality for NetPad.\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { myService, configure } from './services/myService';\nimport type { MyData, MyServiceConfig } from './types';\n\n// Re-export types\nexport * from './types';\n\n// Extension configuration\nlet extensionConfig: MyServiceConfig = {\n  enabled: true,\n};\n\n/**\n * Extension metadata\n */\ninterface ExtensionMetadata {\n  id: string;\n  name: string;\n  version: string;\n  description?: string;\n}\n\n/**\n * Route handler type\n */\ntype RouteHandler = (\n  request: NextRequest,\n  context?: { params?: Record<string, string | string[]> }\n) => Promise<NextResponse>;\n\n/**\n * Extension route definition\n */\ninterface ExtensionRoute {\n  path: string;\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  handler: RouteHandler;\n}\n\n/**\n * Main extension interface\n */\ninterface NetPadExtension {\n  metadata: ExtensionMetadata;\n  features: string[];\n  routes?: ExtensionRoute[];\n  services?: Record<string, unknown>;\n  initialize?: () => Promise<void>;\n  cleanup?: () => Promise<void>;\n}\n\n// ============================================\n// Route Handlers\n// ============================================\n\n/**\n * GET /api/ext/my-extension/data\n * Returns all data items\n */\nasync function handleGetData(request: NextRequest): Promise<NextResponse> {\n  try {\n    const data = await myService.getData();\n    return NextResponse.json({\n      success: true,\n      items: data,\n      total: data.length,\n    });\n  } catch (error) {\n    console.error('[MyExtension] Error getting data:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch data' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/ext/my-extension/data\n * Creates a new data item\n */\nasync function handleCreateData(request: NextRequest): Promise<NextResponse> {\n  try {\n    const body = await request.json();\n\n    // Validate required fields\n    if (!body.name) {\n      return NextResponse.json(\n        { success: false, error: 'Name is required' },\n        { status: 400 }\n      );\n    }\n\n    const data = await myService.createData({\n      name: body.name,\n      description: body.description,\n    });\n\n    return NextResponse.json({\n      success: true,\n      data,\n      message: 'Data created successfully',\n    });\n  } catch (error) {\n    console.error('[MyExtension] Error creating data:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create data' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/ext/my-extension/data/:id\n * Deletes a data item\n */\nasync function handleDeleteData(\n  request: NextRequest,\n  context?: { params?: Record<string, string | string[]> }\n): Promise<NextResponse> {\n  try {\n    // Extract ID from URL\n    const url = new URL(request.url);\n    const pathParts = url.pathname.split('/');\n    const id = pathParts[pathParts.length - 1];\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'ID is required' },\n        { status: 400 }\n      );\n    }\n\n    await myService.deleteData(id);\n\n    return NextResponse.json({\n      success: true,\n      message: 'Data deleted successfully',\n    });\n  } catch (error) {\n    console.error('[MyExtension] Error deleting data:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete data' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * GET /api/ext/my-extension/health\n * Health check endpoint\n */\nasync function handleHealth(request: NextRequest): Promise<NextResponse> {\n  return NextResponse.json({\n    success: true,\n    status: 'healthy',\n    version: myExtension.metadata.version,\n    timestamp: new Date().toISOString(),\n  });\n}\n\n// ============================================\n// Extension Definition\n// ============================================\n\nexport const myExtension: NetPadExtension = {\n  metadata: {\n    id: 'my-extension',\n    name: 'My Extension',\n    version: '1.0.0',\n    description: 'A custom NetPad extension',\n  },\n\n  // Features provided by this extension\n  features: [\n    'custom:my_feature',\n    'custom:my_other_feature',\n  ],\n\n  // API routes\n  routes: [\n    {\n      path: '/api/ext/my-extension/data',\n      method: 'GET',\n      handler: handleGetData,\n    },\n    {\n      path: '/api/ext/my-extension/data',\n      method: 'POST',\n      handler: handleCreateData,\n    },\n    {\n      path: '/api/ext/my-extension/health',\n      method: 'GET',\n      handler: handleHealth,\n    },\n  ],\n\n  // Shared services\n  services: {\n    myService,\n  },\n\n  // Initialization hook\n  initialize: async () => {\n    console.log('[MyExtension] Initializing...');\n\n    // Load configuration from environment\n    extensionConfig = {\n      apiKey: process.env.MY_EXTENSION_API_KEY,\n      enabled: process.env.MY_EXTENSION_ENABLED !== 'false',\n    };\n\n    configure(extensionConfig);\n\n    console.log('[MyExtension] Initialized successfully');\n  },\n\n  // Cleanup hook\n  cleanup: async () => {\n    console.log('[MyExtension] Cleaning up...');\n    // Cleanup resources here\n  },\n};\n\n// Default export for extension loader\nexport default myExtension;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-7-create-react-components",children:"Step 7: Create React Components"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/components/DataList.tsx"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport {\n  Box,\n  List,\n  ListItem,\n  ListItemText,\n  Typography,\n  CircularProgress,\n  Alert,\n  IconButton,\n  alpha,\n  useTheme,\n} from '@mui/material';\nimport { Delete, Refresh } from '@mui/icons-material';\nimport type { MyData } from '../types';\n\nexport interface DataListProps {\n  endpoint?: string;\n  onDelete?: (id: string) => void;\n  refreshInterval?: number;\n}\n\nexport function DataList({\n  endpoint = '/api/ext/my-extension/data',\n  onDelete,\n  refreshInterval,\n}: DataListProps) {\n  const theme = useTheme();\n  const isDark = theme.palette.mode === 'dark';\n\n  const [data, setData] = useState<MyData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchData = async () => {\n    try {\n      const response = await fetch(endpoint);\n      const result = await response.json();\n\n      if (result.success) {\n        setData(result.items);\n        setError(null);\n      } else {\n        setError(result.error || 'Failed to load data');\n      }\n    } catch (err) {\n      setError('Failed to connect to server');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n\n    if (refreshInterval) {\n      const interval = setInterval(fetchData, refreshInterval);\n      return () => clearInterval(interval);\n    }\n  }, [endpoint, refreshInterval]);\n\n  const handleDelete = async (id: string) => {\n    try {\n      const response = await fetch(`${endpoint}/${id}`, { method: 'DELETE' });\n      const result = await response.json();\n\n      if (result.success) {\n        setData(data.filter(item => item.id !== id));\n        onDelete?.(id);\n      }\n    } catch (err) {\n      console.error('Delete failed:', err);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', py: 4 }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  if (error) {\n    return <Alert severity=\"error\">{error}</Alert>;\n  }\n\n  if (data.length === 0) {\n    return (\n      <Box sx={{ textAlign: 'center', py: 4 }}>\n        <Typography color=\"text.secondary\">No data available</Typography>\n      </Box>\n    );\n  }\n\n  return (\n    <List>\n      {data.map((item) => (\n        <ListItem\n          key={item.id}\n          sx={{\n            bgcolor: isDark ? alpha('#fff', 0.02) : alpha('#000', 0.02),\n            borderRadius: 1,\n            mb: 1,\n          }}\n          secondaryAction={\n            <IconButton\n              edge=\"end\"\n              onClick={() => handleDelete(item.id)}\n              sx={{ color: 'error.main' }}\n            >\n              <Delete />\n            </IconButton>\n          }\n        >\n          <ListItemText\n            primary={item.name}\n            secondary={item.description || 'No description'}\n          />\n        </ListItem>\n      ))}\n    </List>\n  );\n}\n\nexport default DataList;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/components/index.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"/**\n * My Extension UI Components\n */\n\nexport { DataList } from './DataList';\nexport type { DataListProps } from './DataList';\n\n// Component IDs for the extension system\nexport const MY_EXTENSION_COMPONENTS = {\n  DATA_LIST: 'my-extension:data-list',\n} as const;\n\nexport type MyExtensionComponentId =\n  (typeof MY_EXTENSION_COMPONENTS)[keyof typeof MY_EXTENSION_COMPONENTS];\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-8-build-the-extension",children:"Step 8: Build the Extension"}),"\n",(0,i.jsx)(n.p,{children:"Install dependencies and build:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install\nnpm run build\n"})}),"\n",(0,i.jsx)(n.p,{children:"Verify the output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ls -la dist/\n# Should show:\n# - index.js, index.mjs, index.d.ts\n# - components/index.js, components/index.mjs, components/index.d.ts\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-9-integrate-with-netpad",children:"Step 9: Integrate with NetPad"}),"\n",(0,i.jsx)(n.h3,{id:"link-the-package",children:"Link the Package"}),"\n",(0,i.jsx)(n.p,{children:"For local development, link the package to NetPad:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# In NetPad root\nnpm install ./packages/my-extension\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Or add to ",(0,i.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "dependencies": {\n    "@myorg/my-extension": "file:packages/my-extension"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"register-the-extension-loader",children:"Register the Extension Loader"}),"\n",(0,i.jsxs)(n.p,{children:["Add to ",(0,i.jsx)(n.code,{children:"src/lib/extensions/loader.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const knownExtensionLoaders: Record<string, () => Promise<unknown>> = {\n  '@netpad/cloud-features': () => import('@netpad/cloud-features').catch(() => null),\n  '@netpad/collaborate': () => import('@netpad/collaborate').catch(() => null),\n  '@myorg/my-extension': () => import('@myorg/my-extension').catch(() => null),\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"enable-the-extension",children:"Enable the Extension"}),"\n",(0,i.jsxs)(n.p,{children:["Add to ",(0,i.jsx)(n.code,{children:".env.local"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"NETPAD_EXTENSIONS=@myorg/my-extension\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-10-test-the-extension",children:"Step 10: Test the Extension"}),"\n",(0,i.jsx)(n.p,{children:"Start NetPad and test:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test the API endpoints:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Health check\ncurl http://localhost:3000/api/ext/my-extension/health\n\n# Get data\ncurl http://localhost:3000/api/ext/my-extension/data\n\n# Create data\ncurl -X POST http://localhost:3000/api/ext/my-extension/data \\\n  -H "Content-Type: application/json" \\\n  -d \'{"name": "Test Item", "description": "A test item"}\'\n\n# Get data again\ncurl http://localhost:3000/api/ext/my-extension/data\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-11-use-components",children:"Step 11: Use Components"}),"\n",(0,i.jsx)(n.p,{children:"Create a page that uses your extension's components:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// src/app/my-extension-demo/page.tsx\n'use client';\n\nimport { Box, Container, Typography } from '@mui/material';\nimport { DataList } from '@myorg/my-extension/components';\n\nexport default function MyExtensionDemoPage() {\n  return (\n    <Container maxWidth=\"md\" sx={{ py: 4 }}>\n      <Typography variant=\"h4\" gutterBottom>\n        My Extension Demo\n      </Typography>\n      <DataList\n        endpoint=\"/api/ext/my-extension/data\"\n        refreshInterval={30000}\n        onDelete={(id) => console.log('Deleted:', id)}\n      />\n    </Container>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"writing-tests",children:"Writing Tests"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"tests/my-extension.test.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { myExtension } from '@myorg/my-extension';\n\ndescribe('My Extension', () => {\n  describe('Metadata', () => {\n    it('should have correct ID', () => {\n      expect(myExtension.metadata.id).toBe('my-extension');\n    });\n\n    it('should have version', () => {\n      expect(myExtension.metadata.version).toBeDefined();\n    });\n  });\n\n  describe('Features', () => {\n    it('should declare custom features', () => {\n      expect(myExtension.features).toContain('custom:my_feature');\n    });\n  });\n\n  describe('Routes', () => {\n    it('should define routes', () => {\n      expect(myExtension.routes).toBeDefined();\n      expect(myExtension.routes?.length).toBeGreaterThan(0);\n    });\n\n    it('should have health endpoint', () => {\n      const healthRoute = myExtension.routes?.find(\n        r => r.path.includes('/health')\n      );\n      expect(healthRoute).toBeDefined();\n    });\n  });\n\n  describe('Services', () => {\n    it('should expose myService', () => {\n      expect(myExtension.services?.myService).toBeDefined();\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"publishing-your-extension",children:"Publishing Your Extension"}),"\n",(0,i.jsx)(n.p,{children:"When ready to publish:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update version in ",(0,i.jsx)(n.code,{children:"package.json"})]}),"\n",(0,i.jsxs)(n.li,{children:["Build the package: ",(0,i.jsx)(n.code,{children:"npm run build"})]}),"\n",(0,i.jsxs)(n.li,{children:["Publish to npm: ",(0,i.jsx)(n.code,{children:"npm publish"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For private extensions, use a private npm registry or ",(0,i.jsx)(n.code,{children:"file:"})," dependencies."]}),"\n",(0,i.jsx)(n.h2,{id:"adding-workflow-nodes",children:"Adding Workflow Nodes"}),"\n",(0,i.jsx)(n.p,{children:"Extensions can provide custom workflow nodes that appear in the workflow editor palette and can be executed by the workflow engine. This is a powerful way to add domain-specific automation capabilities."}),"\n",(0,i.jsx)(n.h3,{id:"step-1-create-the-node-handler",children:"Step 1: Create the Node Handler"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/nodes/myCustomNode.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"/**\n * My Custom Workflow Node\n */\n\n/**\n * Node execution result (matches NetPad core)\n */\ninterface NodeExecutionResult {\n  success: boolean;\n  data: Record<string, unknown>;\n  error?: { code: string; message: string; retryable: boolean };\n  metadata?: { durationMs?: number; bytesProcessed?: number };\n}\n\n/**\n * Node execution context (matches NetPad core)\n */\ninterface NodeExecutionContext {\n  nodeId: string;\n  nodeType: string;\n  config: Record<string, unknown>;\n  resolvedConfig: Record<string, unknown>;\n  inputs: Record<string, unknown>;\n  trigger: { type: string; payload?: Record<string, unknown> };\n  getConnection: (vaultId: string) => Promise<{ connectionString: string; database: string } | null>;\n  getEmailCredentials: (credentialId: string) => Promise<unknown>;\n}\n\nexport type NodeHandler = (context: NodeExecutionContext) => Promise<NodeExecutionResult>;\n\n/**\n * Configuration for the node\n */\nexport interface MyCustomNodeConfig {\n  message?: string;\n  targetUrl?: string;\n  retryCount?: number;\n}\n\n/**\n * Node handler - executed when the node runs in a workflow\n */\nexport const myCustomNodeHandler: NodeHandler = async (context) => {\n  const startTime = Date.now();\n\n  try {\n    const config = context.resolvedConfig as MyCustomNodeConfig;\n\n    // Validate required configuration\n    if (!config.message) {\n      return {\n        success: false,\n        data: {},\n        error: {\n          code: 'MISSING_CONFIG',\n          message: 'Message is required',\n          retryable: false,\n        },\n      };\n    }\n\n    // Your custom logic here\n    const result = {\n      processed: true,\n      message: config.message,\n      timestamp: new Date().toISOString(),\n    };\n\n    // If target URL is configured, send the data\n    if (config.targetUrl) {\n      const response = await fetch(config.targetUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(result),\n      });\n\n      if (!response.ok) {\n        return {\n          success: false,\n          data: { result },\n          error: {\n            code: 'OPERATION_FAILED',\n            message: `Request failed: ${response.status}`,\n            retryable: true,\n          },\n        };\n      }\n    }\n\n    return {\n      success: true,\n      data: { result },\n      metadata: {\n        durationMs: Date.now() - startTime,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      data: {},\n      error: {\n        code: 'INTERNAL_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n        retryable: false,\n      },\n    };\n  }\n};\n\n/**\n * Node definition - describes the node for the UI\n */\nexport const myCustomNodeDefinition = {\n  type: 'my-extension:custom-node',  // Use extension-namespaced type\n  label: 'My Custom Action',\n  description: 'Performs a custom action in your workflow',\n  category: 'actions' as const,\n  color: '#FF5722',  // Node color in the palette\n  icon: 'Extension',  // MUI icon name\n  version: '1.0.0',\n  configFields: [\n    {\n      name: 'message',\n      label: 'Message',\n      type: 'text' as const,\n      required: true,\n      placeholder: 'Enter message...',\n      helpText: 'The message to process',\n    },\n    {\n      name: 'targetUrl',\n      label: 'Target URL',\n      type: 'text' as const,\n      placeholder: 'https://...',\n      helpText: 'Optional webhook URL to send results',\n    },\n    {\n      name: 'retryCount',\n      label: 'Retry Count',\n      type: 'number' as const,\n      defaultValue: 3,\n      helpText: 'Number of retries on failure',\n    },\n  ],\n  outputs: [\n    { id: 'output', label: 'Success', primary: true },\n  ],\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-export-the-node",children:"Step 2: Export the Node"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/nodes/index.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export {\n  myCustomNodeHandler,\n  myCustomNodeDefinition,\n  type MyCustomNodeConfig,\n  type NodeHandler,\n} from './myCustomNode';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-register-in-the-extension",children:"Step 3: Register in the Extension"}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"src/index.ts"})," to include workflow nodes:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import {\n  myCustomNodeHandler,\n  myCustomNodeDefinition,\n} from './nodes';\n\n/**\n * Workflow node type for extension registration\n */\ninterface ExtensionWorkflowNode {\n  definition: {\n    type: string;\n    label: string;\n    description: string;\n    category: 'triggers' | 'logic' | 'integrations' | 'actions' | 'data' | 'ai' | 'forms' | 'custom' | 'annotations';\n    color: string;\n    icon: string;\n    version: string;\n    configFields?: Array<{\n      name: string;\n      label: string;\n      type: string;\n      defaultValue?: unknown;\n      placeholder?: string;\n      helpText?: string;\n      required?: boolean;\n      options?: Array<{ label: string; value: string }>;\n    }>;\n    outputs?: Array<{ id: string; label: string; primary?: boolean }>;\n  };\n  handler: unknown;  // NodeHandler\n}\n\nexport const myExtension: NetPadExtension = {\n  metadata: {\n    id: 'my-extension',\n    name: 'My Extension',\n    version: '1.0.0',\n  },\n\n  features: [\n    'custom:my_feature',\n    'custom:workflow_nodes',  // Indicate workflow node support\n  ],\n\n  // Custom workflow nodes\n  workflowNodes: [\n    {\n      definition: myCustomNodeDefinition,\n      handler: myCustomNodeHandler as unknown,\n    },\n  ],\n\n  routes: [\n    // ... your routes\n  ],\n\n  initialize: async () => {\n    console.log('[MyExtension] Initialized with custom workflow nodes');\n  },\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-update-build-configuration",children:"Step 4: Update Build Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Add nodes to ",(0,i.jsx)(n.code,{children:"tsup.config.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export default defineConfig({\n  entry: {\n    index: 'src/index.ts',\n    'components/index': 'src/components/index.ts',\n    'nodes/index': 'src/nodes/index.ts',  // Add this\n  },\n  // ... rest of config\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["And ",(0,i.jsx)(n.code,{children:"package.json"})," exports:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "types": "./dist/index.d.ts",\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.js"\n    },\n    "./components": {\n      "types": "./dist/components/index.d.ts",\n      "import": "./dist/components/index.mjs",\n      "require": "./dist/components/index.js"\n    },\n    "./nodes": {\n      "types": "./dist/nodes/index.d.ts",\n      "import": "./dist/nodes/index.mjs",\n      "require": "./dist/nodes/index.js"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsx)(n.p,{children:"When your extension is loaded:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Registration"}),": The extension loader registers each workflow node with the core workflow node registry via ",(0,i.jsx)(n.code,{children:"registerExtensionNode()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"UI Integration"}),": The NodePalette component fetches extension nodes via ",(0,i.jsx)(n.code,{children:"/api/ext/workflow-nodes"}),' and displays them alongside built-in nodes with an "Ext" badge']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Node Rendering"}),": When dropped on the canvas, extension metadata (color, icon) is stored in the node config and passed to ",(0,i.jsx)(n.code,{children:"BaseNode"})," for custom styling"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configuration"}),": The ",(0,i.jsx)(n.code,{children:"ExtensionNodeEditor"})," dynamically renders config fields based on your ",(0,i.jsx)(n.code,{children:"configFields"})," definition"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Execution"}),": When a workflow runs, the executor looks up handlers by node type and invokes your custom handler"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"architecture-diagram",children:"Architecture Diagram"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Extension Package                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 Node Handler \u2502  \u2502  Node        \u2502  \u2502 Extension Definition \u2502  \u2502\n\u2502  \u2502 (execution)  \u2502  \u2502  Definition  \u2502  \u2502 (workflowNodes: [])  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     NetPad Core                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 Extension Loader \u2502\u2192 \u2502 Node Registry   \u2502\u2192 \u2502 /api/ext/     \u2502  \u2502\n\u2502  \u2502 (registers node) \u2502  \u2502 (stores def +   \u2502  \u2502 workflow-nodes\u2502  \u2502\n\u2502  \u2502                  \u2502  \u2502  handler)       \u2502  \u2502 (serves JSON) \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Workflow Editor UI                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 NodePalette  \u2502\u2192 \u2502 Canvas       \u2502\u2192 \u2502 NodeConfigPanel      \u2502  \u2502\n\u2502  \u2502 (shows node  \u2502  \u2502 (BaseNode    \u2502  \u2502 (ExtensionNodeEditor \u2502  \u2502\n\u2502  \u2502  with badge) \u2502  \u2502  with color) \u2502  \u2502  renders fields)     \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Workflow Executor                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 Looks up handler by node.type \u2192 calls handler(context)   \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"node-definition-fields",children:"Node Definition Fields"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"type"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["Unique identifier, should be namespaced (e.g., ",(0,i.jsx)(n.code,{children:"my-extension:node-name"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"label"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Display name in the palette"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"description"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Tooltip description"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"category"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["Category for grouping: ",(0,i.jsx)(n.code,{children:"triggers"}),", ",(0,i.jsx)(n.code,{children:"logic"}),", ",(0,i.jsx)(n.code,{children:"integrations"}),", ",(0,i.jsx)(n.code,{children:"actions"}),", ",(0,i.jsx)(n.code,{children:"data"}),", ",(0,i.jsx)(n.code,{children:"ai"}),", ",(0,i.jsx)(n.code,{children:"forms"}),", ",(0,i.jsx)(n.code,{children:"custom"}),", ",(0,i.jsx)(n.code,{children:"annotations"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"color"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["Hex color for the node (e.g., ",(0,i.jsx)(n.code,{children:"#FF5722"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"icon"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["MUI icon name (e.g., ",(0,i.jsx)(n.code,{children:"Extension"}),", ",(0,i.jsx)(n.code,{children:"Code"}),", ",(0,i.jsx)(n.code,{children:"Http"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"version"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Node version"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"configFields"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Configuration fields for the node settings panel"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"outputs"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsxs)(n.td,{children:["Output handles (defaults to single ",(0,i.jsx)(n.code,{children:"output"}),")"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"available-icons",children:"Available Icons"}),"\n",(0,i.jsx)(n.p,{children:"Use any of these MUI icon names:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Extension"}),", ",(0,i.jsx)(n.code,{children:"Code"}),", ",(0,i.jsx)(n.code,{children:"Http"}),", ",(0,i.jsx)(n.code,{children:"Storage"}),", ",(0,i.jsx)(n.code,{children:"Email"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SmartToy"}),", ",(0,i.jsx)(n.code,{children:"Transform"}),", ",(0,i.jsx)(n.code,{children:"Category"}),", ",(0,i.jsx)(n.code,{children:"Description"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Notifications"}),", ",(0,i.jsx)(n.code,{children:"FilterList"}),", ",(0,i.jsx)(n.code,{children:"MergeType"}),", ",(0,i.jsx)(n.code,{children:"DataObject"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TableChart"}),", ",(0,i.jsx)(n.code,{children:"Schedule"}),", ",(0,i.jsx)(n.code,{children:"Loop"}),", ",(0,i.jsx)(n.code,{children:"Timer"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CallSplit"}),", ",(0,i.jsx)(n.code,{children:"Link"}),", ",(0,i.jsx)(n.code,{children:"PlayArrow"}),", ",(0,i.jsx)(n.code,{children:"StickyNote2"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"config-field-types",children:"Config Field Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example Use Case"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"text"})}),(0,i.jsx)(n.td,{children:"Single-line text input with variable picker"}),(0,i.jsx)(n.td,{children:"URLs, email addresses, short strings"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"textarea"})}),(0,i.jsx)(n.td,{children:"Multi-line text input with variable picker"}),(0,i.jsx)(n.td,{children:"Message templates, body content"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsx)(n.td,{children:"Numeric input"}),(0,i.jsx)(n.td,{children:"Timeouts, retry counts, limits"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:"Checkbox/toggle switch"}),(0,i.jsx)(n.td,{children:"Enable/disable features"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"select"})}),(0,i.jsx)(n.td,{children:"Dropdown with predefined options"}),(0,i.jsx)(n.td,{children:"Channel selection, mode selection"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"select-field-options",children:"Select Field Options"}),"\n",(0,i.jsxs)(n.p,{children:["For ",(0,i.jsx)(n.code,{children:"select"})," fields, provide an ",(0,i.jsx)(n.code,{children:"options"})," array:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  name: 'channel',\n  label: 'Channel',\n  type: 'select' as const,\n  defaultValue: 'email',\n  options: [\n    { label: 'Email', value: 'email' },\n    { label: 'Slack', value: 'slack' },\n    { label: 'Webhook', value: 'webhook' },\n  ],\n  helpText: 'How to deliver the notification',\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"variable-support-in-config-fields",children:"Variable Support in Config Fields"}),"\n",(0,i.jsxs)(n.p,{children:["Text and textarea fields automatically include a variable picker button that allows users to insert template variables like ",(0,i.jsx)(n.code,{children:"{{nodes.previousNode.data.field}}"}),". Your handler receives these as strings in ",(0,i.jsx)(n.code,{children:"context.resolvedConfig"})," with variables already substituted."]}),"\n",(0,i.jsx)(n.h3,{id:"error-codes",children:"Error Codes"}),"\n",(0,i.jsx)(n.p,{children:"Use consistent error codes in your handler responses:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Code"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Retryable"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"MISSING_CONFIG"})}),(0,i.jsx)(n.td,{children:"Required configuration is missing"}),(0,i.jsx)(n.td,{children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INVALID_CONFIG"})}),(0,i.jsx)(n.td,{children:"Configuration value is invalid"}),(0,i.jsx)(n.td,{children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"OPERATION_FAILED"})}),(0,i.jsx)(n.td,{children:"The operation failed (e.g., HTTP error)"}),(0,i.jsx)(n.td,{children:"Usually Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CONNECTION_FAILED"})}),(0,i.jsx)(n.td,{children:"Could not connect to external service"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TIMEOUT"})}),(0,i.jsx)(n.td,{children:"Operation timed out"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INTERNAL_ERROR"})}),(0,i.jsx)(n.td,{children:"Unexpected error in handler"}),(0,i.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"testing-your-workflow-node",children:"Testing Your Workflow Node"}),"\n",(0,i.jsxs)(n.p,{children:["Create a test file ",(0,i.jsx)(n.code,{children:"src/nodes/__tests__/myCustomNode.test.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { describe, it, expect, vi } from 'vitest';\nimport { myCustomNodeHandler } from '../myCustomNode';\n\ndescribe('myCustomNodeHandler', () => {\n  const createContext = (config: Record<string, unknown>) => ({\n    nodeId: 'test-node-1',\n    nodeType: 'my-extension:custom-node',\n    config,\n    resolvedConfig: config,\n    inputs: {},\n    trigger: { type: 'manual' },\n    getConnection: vi.fn(),\n    getEmailCredentials: vi.fn(),\n  });\n\n  it('should return error when message is missing', async () => {\n    const result = await myCustomNodeHandler(createContext({}));\n\n    expect(result.success).toBe(false);\n    expect(result.error?.code).toBe('MISSING_CONFIG');\n  });\n\n  it('should succeed with valid config', async () => {\n    const result = await myCustomNodeHandler(\n      createContext({ message: 'Hello world' })\n    );\n\n    expect(result.success).toBe(true);\n    expect(result.data.result).toBeDefined();\n  });\n\n  it('should call webhook when targetUrl provided', async () => {\n    global.fetch = vi.fn().mockResolvedValue({ ok: true });\n\n    const result = await myCustomNodeHandler(\n      createContext({\n        message: 'Test',\n        targetUrl: 'https://example.com/webhook',\n      })\n    );\n\n    expect(result.success).toBe(true);\n    expect(fetch).toHaveBeenCalledWith(\n      'https://example.com/webhook',\n      expect.objectContaining({ method: 'POST' })\n    );\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"general-extension-development",children:"General Extension Development"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Namespace everything"})," - Use unique prefixes for routes, features, components, and node types"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle errors gracefully"})," - Never crash the main application"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use TypeScript"})," - Provides better developer experience and catches bugs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document your extension"})," - Include README with usage examples"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Write tests"})," - Cover critical functionality"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Version carefully"})," - Follow semantic versioning"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"workflow-node-best-practices",children:"Workflow Node Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Namespace node types"})," - Always use ",(0,i.jsx)(n.code,{children:"extension-name:node-name"})," format (e.g., ",(0,i.jsx)(n.code,{children:"collaborate:notify-collaborators"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validate early"})," - Check required configuration at the start of your handler and return clear errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use appropriate error codes"})," - ",(0,i.jsx)(n.code,{children:"MISSING_CONFIG"}),", ",(0,i.jsx)(n.code,{children:"OPERATION_FAILED"}),", ",(0,i.jsx)(n.code,{children:"CONNECTION_FAILED"}),", etc."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Set ",(0,i.jsx)(n.code,{children:"retryable"})," correctly"]})," - Transient failures (network, rate limits) should be retryable; validation errors should not"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Include metadata"})," - Track ",(0,i.jsx)(n.code,{children:"durationMs"})," for performance monitoring"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document config fields"})," - Use clear ",(0,i.jsx)(n.code,{children:"helpText"})," for each field to guide users"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Support variables"})," - Text fields automatically support ",(0,i.jsx)(n.code,{children:"{{variable}}"})," syntax via ",(0,i.jsx)(n.code,{children:"resolvedConfig"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep handlers focused"})," - One node should do one thing well"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validate URLs"})," - If your node makes HTTP requests, validate URLs are well-formed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Don't expose secrets"})," - Never log or return sensitive configuration values"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sanitize outputs"})," - Be careful about what data you pass to downstream nodes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle timeouts"})," - Set reasonable timeouts for external calls"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./workflow-nodes",children:"Workflow Node Extensions"})," - Complete workflow node reference"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./api-reference",children:"API Reference"})," - Complete API documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./example-collaborate",children:"Example: Collaborate Extension"})," - Real-world walkthrough"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./architecture",children:"Extension Architecture"})," - Deep dive into internals"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);